"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1570],{37761:function(e,r,t){var n,a,i=t(67294);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},o.apply(this,arguments)}r.Z=function(e){return i.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:"1em",height:"1em",viewBox:"0 0 24 24"},e),n||(n=i.createElement("defs",null,i.createElement("path",{fill:"currentColor",id:"plus_svg__a",d:"M14 10.5h6a1.5 1.5 0 010 3h-6v6a1.5 1.5 0 01-3 0v-6H5a1.5 1.5 0 010-3h6v-6a1.5 1.5 0 013 0v6z"}))),a||(a=i.createElement("use",{fillRule:"evenodd",xlinkHref:"#plus_svg__a"})))}},71570:function(e,r,t){var n=t(50029),a=t(27812),i=t(39389),o=t.n(i),s=t(87794),c=t.n(s),l=t(66642),p=t(56864),d=t(62465),u=t(53772),m=t(1748),y=t(37761),x=t(86820),f=t(66369),g=t(78757),h=t(35670),b=t(72929),j=t(67294),Z=t(85893),v=[];r.Z=function(e){var r,t=e.onClose,i=e.shoppingInfo,s=void 0===i?v:i,k=e.productId,w=e.title,M=(0,g.B)(),_=(0,x.a)(),L=(0,f.q)(),S=(0,j.useState)([]),z=S[0],O=S[1],B=(0,j.useState)([]),E=(B[0],B[1]),N=(0,j.useState)(""),P=N[0],I=N[1];(0,j.useEffect)((function(){if(_.isLoggedIn){var e,r,t=null==L||null===(e=L["DELIVERY_EXPRESS"===L.deliveryType?"DELIVERY":L.deliveryType])||void 0===e?void 0:e.storeId;M.getShoppingList(null==_||null===(r=_.user)||void 0===r?void 0:r.id,t)}}),[]);var q=(0,j.useState)(!1),C=q[0],T=q[1],A=(0,j.useState)(!1),D=A[0],F=A[1];(0,j.useEffect)((function(){if(Array.isArray(k)&&Array.isArray(M.shoppingList)){var e,r=(null===(e=M.shoppingList)||void 0===e?void 0:e.map((function(e){var r,t=null===(r=e.items)||void 0===r?void 0:r.map((function(e){return e.product.id}));return{listId:e.id,product:(null==t?void 0:t.length)>0?(0,a.Z)(t):void 0}}))).filter((function(e){return k.every((function(r){var t;return null===(t=e.product)||void 0===t?void 0:t.includes(r)}))})).map((function(e){return e.listId}));O((0,a.Z)(r)),E((0,a.Z)(r))}else O((0,a.Z)(s)),E((0,a.Z)(s))}),[s,M.shoppingList,k]);var R=function(){var e=(0,n.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:C?(H(P),T(!1)):(V(z),t());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=(0,n.Z)(c().mark((function e(r){var n,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F(!0),n=[],k.forEach((function(e){n.some((function(r){return r.product.id===e}))||n.push({product:{id:e},quantity:1})})),e.prev=3,e.next=6,M.createShoppingList(r,null==_||null===(a=_.user)||void 0===a?void 0:a.id,n);case 6:t();case 7:return e.prev=7,F(!1),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[3,,7,10]])})));return function(r){return e.apply(this,arguments)}}(),V=function(e){e.forEach(function(){var e=(0,n.Z)(c().mark((function e(r){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=M.shoppingList.find((function(e){return e.id===r}));try{M.addToShoppingList(n.uuid,k),t()}catch(e){b.k.error(e)}case 2:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}())};return(0,Z.jsxs)(p.Z,{onClose:t,children:[(0,Z.jsxs)("div",{className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+" create-shopping-list",children:[(0,Z.jsx)("div",{"aria-hidden":"true",onClick:t,className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+" background-action-close"}),(0,Z.jsx)("div",{className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+" wrapper",children:D?(0,Z.jsx)(m.Z,{style:{margin:"auto",fontSize:"60px",alignSelf:"center"}}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)("h3",{className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+" title",children:[(0,Z.jsx)("i",{className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+" plusIcon",children:(0,Z.jsx)(y.Z,{})}),w||"Ajouter le produit à la liste"]}),(0,Z.jsxs)("div",{className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+" inputContent",children:[null===(r=M.shoppingList)||void 0===r?void 0:r.map((function(e,r){return(0,Z.jsxs)("label",{id:e.id+e.label,className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+"  label",children:[(0,Z.jsx)("input",{type:"checkbox","aria-labelledby":e.id+e.label,value:e.id,onChange:(t=e.id,function(e){e.currentTarget.checked?O((function(e){return[].concat((0,a.Z)(e),[t])})):O((function(e){return e.filter((function(e){return e!==t}))}))}),checked:z.includes(e.id),className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+" brand-check"}),e.label]},r);var t})),(0,Z.jsxs)("div",{className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+" add-list",children:[(0,Z.jsx)("button",{id:"btn-open-add-list","data-test":"btn-open-add-list",onClick:function(){return T(!C)},"aria-expanded":C,"aria-label":"Afficher l'entrée pour le nom de la nouvelle liste","aria-controls":"add-list-input",className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+" btn-open-add-list",children:"Créer une nouvelle liste"}),C&&(0,Z.jsx)("div",{id:"add-list-input","aria-labelledby":"btn-open-add-list",className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+" add-list-input",children:(0,Z.jsx)(l.o,{onChange:function(e){return I(e)},validate:function(e){return!!e.trim().length&&e.length<30},invalidText:"le champs est invalide",style:{gridColumn:"2 / 4",marginBottom:"20px"},label:"Nom de la liste",autoFocus:!0,dataTest:"memo-name"})})]})]}),(0,Z.jsxs)("div",{className:o().dynamic([["4000871083",[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane]]])+" btn-block",children:[(0,Z.jsx)(u.Z,{onClick:t,style:{padding:"8px 16px",fontSize:"14px",textTransform:"capitalize"},children:"Annuler"}),(0,Z.jsx)(d.Z,{onClick:R,style:{padding:"8px 16px",fontSize:"14px",marginLeft:"16px"},dataTest:"add-product-to-list",children:"Confirmer"})]})]})})]}),(0,Z.jsx)(o(),{id:"4000871083",dynamic:[h.Z.colors.modalBackground,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.primaryMarjane,h.Z.colors.secondary,h.Z.colors.primaryMarjane],children:".create-shopping-list.__jsx-style-dynamic-selector{height:100vh;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:fixed;top:0;left:0;z-index:1001;}.background-action-close.__jsx-style-dynamic-selector{height:100%;width:100%;position:absolute;background-color:".concat(h.Z.colors.modalBackground,";z-index:-1;}.wrapper.__jsx-style-dynamic-selector{min-height:343px;width:304px;background:white;border-radius:7px;padding:24px 24px 16px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}.title.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:34px;}.plusIcon.__jsx-style-dynamic-selector{font-size:24px;margin-right:16px;color:").concat(h.Z.colors.primaryMarjane,";}h3.__jsx-style-dynamic-selector{font-size:16px;-webkit-letter-spacing:0.5px;-moz-letter-spacing:0.5px;-ms-letter-spacing:0.5px;letter-spacing:0.5px;line-height:19px;}.inputContent.__jsx-style-dynamic-selector{padding-left:40px;max-height:400px;overflow-y:auto;}.btn-block.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;}.btn.__jsx-style-dynamic-selector{border:1px solid #9ab7d5;border-radius:7px;padding:8px 16px;font-size:14px;font-weight:bold;-webkit-letter-spacing:1px;-moz-letter-spacing:1px;-ms-letter-spacing:1px;letter-spacing:1px;line-height:16px;text-align:center;color:").concat(h.Z.colors.primaryMarjane,";text-transform:capitalize;cursor:pointer;}.active.__jsx-style-dynamic-selector{padding:8px 16px;background:").concat(h.Z.colors.primaryMarjane,";color:").concat(h.Z.colors.secondary,';text-transform:uppercase;margin-left:16px;font-size:14px;font-weight:bold;-webkit-letter-spacing:1px;-moz-letter-spacing:1px;-ms-letter-spacing:1px;letter-spacing:1px;line-height:16px;text-align:center;}.disabled.__jsx-style-dynamic-selector{cursor:no-drop;}.label.__jsx-style-dynamic-selector input.__jsx-style-dynamic-selector{margin-right:9px;}.label.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:11px 0;opacity:0.8;color:#000000;font-size:14px;-webkit-letter-spacing:0.44px;-moz-letter-spacing:0.44px;-ms-letter-spacing:0.44px;letter-spacing:0.44px;line-height:18px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.brand-check.__jsx-style-dynamic-selector{margin-left:0;}.add-list.__jsx-style-dynamic-selector{margin-top:16px;padding-left:11px;margin-bottom:59px;}.btn-open-add-list.__jsx-style-dynamic-selector{font-family:"DefaultFont";padding:0;color:').concat(h.Z.colors.primaryMarjane,";font-size:14px;font-weight:bold;-webkit-letter-spacing:0.25px;-moz-letter-spacing:0.25px;-ms-letter-spacing:0.25px;letter-spacing:0.25px;line-height:16px;-webkit-text-decoration:underline;text-decoration:underline;}.add-list-input.__jsx-style-dynamic-selector{margin-top:16px;}")})]})}},78757:function(e,r,t){t.d(r,{B:function(){return x}});var n=t(27812),a=t(59499),i=t(50029),o=t(87794),s=t.n(o),c=t(96568),l=t(72929),p=t(14671),d=t(66369),u=t(63221);function m(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function y(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?m(Object(t),!0).forEach((function(r){(0,a.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):m(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var x=(0,p.Z)((function(e,r){return{shoppingList:null,loading:!1,getShoppingList:(x=(0,i.Z)(s().mark((function t(n,a,i){var o,p;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e({loading:!0}),t.prev=1,t.next=4,c.ZP.requests.getShoppingLists(n.toString(),y({customer:n},a&&{entity:a}));case 4:if(o=t.sent,p=o.data,e({shoppingList:p}),!i){t.next=10;break}return t.next=10,Promise.all(p.map((function(e){var t=e.uuid;return r().getShoppingListItems(t,a)})));case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),l.k.error(t.t0);case 15:return t.prev=15,e(y(y({},r()),{},{loading:!1})),t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[1,12,15,18]])}))),function(e,r,t){return x.apply(this,arguments)}),getShoppingListItems:(m=(0,i.Z)(s().mark((function t(n,a){var i,o,p;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.ZP.requests.getShoppingListItems(n,y({},a&&{entity:a}));case 3:i=t.sent,o=i.data,p=r(),e({shoppingList:p.shoppingList.map((function(e){return e.uuid===n?y(y({},e),{},{items:o}):e}))}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),l.k.error(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))),function(e,r){return m.apply(this,arguments)}),createShoppingList:(p=(0,i.Z)(s().mark((function t(a,i,o){var p,d,m;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.ZP.requests.addShoppingList({label:a,customer:{id:i},items:o});case 3:p=t.sent,d=p.data,m=r(),e({shoppingList:[].concat((0,n.Z)(m.shoppingList),[d])}),u.z.getState().pushNotification("La liste de courses a été créée","success"),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),l.k.error(t.t0),u.z.getState().pushNotification("La liste n'a pas pu être ajouté","error");case 14:case"end":return t.stop()}}),t,null,[[0,10]])}))),function(e,r,t){return p.apply(this,arguments)}),addToShoppingList:(o=(0,i.Z)(s().mark((function t(a,i){var o,p,d,m,y,x;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.ZP.requests.getShoppingListItems(a);case 3:if(o=t.sent,p=o.data,!((d=i.map((function(e){return p.map((function(e){return e.product.id})).includes(e)?void 0:{product:{id:e},quantity:1}})).filter(Boolean)).length>0)){t.next=13;break}return t.next=9,c.ZP.requests.updateShoppingList(a,{items:[].concat((0,n.Z)(p.map((function(e){return{product:{id:e.product.id},quantity:e.quantity}}))),(0,n.Z)(d))});case 9:m=t.sent,y=m.data,x=r(),e({shoppingList:[].concat((0,n.Z)(x.shoppingList.filter((function(e){return e.uuid!==a}))),[y])});case 13:u.z.getState().pushNotification(i.length>1?"Les produits ont bien été ajoutés":"Le produit a bien été ajouté","success"),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(0),l.k.error(t.t0),u.z.getState().pushNotification("Erreur lors de l'ajout","error");case 20:case"end":return t.stop()}}),t,null,[[0,16]])}))),function(e,r){return o.apply(this,arguments)}),removeFromShoppingList:(a=(0,i.Z)(s().mark((function e(t,n){var a,i,o,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.ZP.requests.getShoppingListItems(t);case 3:return a=e.sent,i=a.data,o=d.q.getState().storeId,p=i.filter((function(e){var r=e.product;return!n.includes(r.id)})).map((function(e){return{product:{id:e.product.id},quantity:e.quantity}})),e.next=9,c.ZP.requests.updateShoppingList(t,{items:p});case 9:r().getShoppingListItems(t,o),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),l.k.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])}))),function(e,r){return a.apply(this,arguments)}),deleteShoppingList:(t=(0,i.Z)(s().mark((function t(n){var a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.ZP.requests.deleteShoppingList(n);case 3:a=r(),e({shoppingList:a.shoppingList.filter((function(e){return e.id!==n}))}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),l.k.error(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])}))),function(e){return t.apply(this,arguments)})};var t,a,o,p,m,x}))}}]);